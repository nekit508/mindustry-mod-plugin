# Настройки

Настройки можно разделить на два вида: глобальные (те что необходимы для работы проекта на каждой машине, например, список зависимостей) 
и локальные (те что могут изменять от машины к машине, например, путь к android sdk).

Глобальные настройки производятся в build.gradle и представляют собой изменение параметров отдельных тасков.

Локальные настройки хранятся в файле `settings/local.json`.
Его полная структура такова:
```json lines
{
    "build": {
        "useAndroid": "boolean",
        "sdkRoot": "string"
    },
    "copy": [
        "string", "string", "string..."
    ]
}
```
Каждый параметр, как и сам `local.json`, опционален.
Файл должен находиться в исключениях любой системы контроля версий.

# Таски
Список предоставляющий информацию о каждом таске: его тип, зависимости, применение, описание и список параметров.

<a name="nmpBuild"></a>
# nmpBuild

### Тип: BuildTask extends Jar

### Зависит от: classes

### Используется в: [nmpDex](#nmpDex)

### Описание:
Собирает мод в сырой jar архив, содержащий ассеты и скомпилированные классы.

Изначально архив располагается во временной папке проекта.
Можно изменить задав параметр `archiveFile`.

### Параметры:
- `archiveFile` - путь к jar архиву в формате `path/to/your/file.jar`

# nmpDex

### Тип: DexTask extends DefaultTask

### Зависит от: [nmpBuild](#nmpBuild)

### Используется в: [nmpBuildRelease](#nmpBuildRelease)

### Описание:
Компилирует классы полученные из архива nmpBuild под платформу android (в .dex файл). 
Полученный jar архив находится во временной папке проекта.

Необходимость компиляции мода под android определяется параметром `build.sdkRoot` в локальных настройках.
По умолчанию эта опция включена, поэтому, чтобы выключить её, нужно в локальных настройках задать параметр `build.sdkRoot = false`.
Это поведение можно изменить посредством изменения параметра `buildAndroid`.

Компилятор d8 ищется в `build.sdkRoot` локальных настроек, системной переменной `ANDROID_HOME` и `ANDROID_SDK_ROOT` (параметры указаны в порядке **убывания** приоритета).
Путь в настройках и системных переменных должен вести к директории содержащей папку platforms.
Это поведение можно изменить посредством изменения параметра `sdkRoot`.

### Параметры:
- `dexFile` - путь к jar архиву, содержащему .dex файл в формате `path/to/your/file.jar`
- `sdkRoot` - путь к корневой папке android sdk
- `buildAndroid` - будет ли jar архив с .dex файлом собран (не отменяет само выполнение таска, т.е. он останется в графе выполнения, но .dex файл не соберётся и android sdk для сборки всего проекта нужен не будет)

# nmpBuildRelease

### Тип: BuildReleaseTask extends Jar

### Зависит от: [nmpDex](#nmpDex), [nmpBuild](#nmpBuild)

### Используется в: [nmpCopyBuildRelease](#nmpCopyBuildRelease)

### Описание:
Компонует jar архивы полученные в [`nmpBuild`](#nmpBuild) и [`nmpDex`](#nmpDex) в один.
Этот архив является конечным продуктом сборки и может быть запущен на любой платформе.

Путь к конечному архиву задаётся параметром `archiveFile`, изначально архив сохраняется в папке libs проекта.

### Параметры:
- `archiveFile` - путь к собранному jar архиву в формате `path/to/your/file.jar`

# nmpCopyBuildRelease

### Тип: CopyBuildReleaseTask extends DefaultTask

### Зависит от: [nmpBuildRelease](#nmpBuildRelease)

### Описание:
Копирует архив собранный таском [nmpBuildRelease](#nmpBuildRelease) в папки заданные в `copyPaths`.

Папки для копирования берутся из локального параметра `copy`.
Это поведение можно изменить посредством изменения параметра `copyPaths`.

### Параметры:
- `copyPaths` - список папок для копирования.

# copyBuildRelease и buildRelease

### Тип: DelegatorTask extends DefaultTask

### Описание: 
Легаси таски используемые для совместимости со старыми версиями плагина.
Вызывают [`nmpCopyBuildRelease`](#nmpCopyBuildRelease) и [`nmpBuildRelease`](#nmpBuildRelease) соответственно.

# Рекомендации к применению
Перед сборкой проекта, если нет необходимости компилировать .dex на локальной машине, лучше установить локальный параметр `build.useAndroid = false`.

Для удобства рекомендуется настроить пути для копирования финального архива.
**К примеру:**
```json5
{
    "copy": [
        "C:\\Users\\nekit508\\AppData\\Roaming\\Mindustry\\mods"
    ]
}
```

Для сборки проекта на локальной машине рекомендуется использовать [`nmpCopyBuildRelease`](#nmpCopyBuildRelease), а для сборки проекта на таких платформах как jitpack практичней использовать [`nmpBuildRelease`](#nmpBuildRelease).